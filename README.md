# Energy Arbitrage Integration –¥–ª—è Home Assistant

–ö–∞—Å—Ç–æ–º–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è Home Assistant, —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è **–ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∞—Ä–±–∏—Ç—Ä–∞–∂** —Å —Å–æ–ª–Ω–µ—á–Ω—ã–º–∏ –ø–∞–Ω–µ–ª—è–º–∏ –∏ –±–∞—Ç–∞—Ä–µ—è–º–∏.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üß† **–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 24-48 —á–∞—Å–æ–≤ –≤–ø–µ—Ä–µ–¥ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ PV –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
- üéØ **–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚è∞ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞**: –¢–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ü–µ–Ω–æ–≤—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- üîã **–£–º–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∫—É–ø–∫–∞ –¥–µ—à–µ–≤–æ–π –∏ –ø—Ä–æ–¥–∞–∂–∞ –¥–æ—Ä–æ–≥–æ–π —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏
- ‚òÄÔ∏è **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Solcast**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ PV –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- üìä **MQTT –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—á–∞—Å–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ —á–µ—Ä–µ–∑ MQTT
- ‚ö° **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–º**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã
- üéõÔ∏è **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ UI Home Assistant
- üìà **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∏ –ø–ª–∞–Ω–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ß–µ—Ä–µ–∑ HACS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ HACS –≤ Home Assistant
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Integrations"
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç—Ä–∏ —Ç–æ—á–∫–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É
4. –í—ã–±–µ—Ä–∏—Ç–µ "Custom repositories"
5. –î–æ–±–∞–≤—å—Ç–µ URL: `https://github.com/rviar/ha-energy-arbitrage`
6. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "Integration"
7. –ù–∞–∂–º–∏—Ç–µ "Add"
8. –ù–∞–π–¥–∏—Ç–µ "Energy Arbitrage" –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–∞—á–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–ª–∏–∑
2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –≤ –ø–∞–ø–∫—É `custom_components/energy_arbitrage/`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Home Assistant

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

1. **–°–æ–ª–Ω–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** (ha-solarman):
   - `sensor.inverter_pv_power` - —Ç–µ–∫—É—â–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
2. **–ü—Ä–æ–≥–Ω–æ–∑ —Å–æ–ª–Ω–µ—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** (ha-solcast-solar):

   - `sensor.solcast_pv_forecast_forecast_today`
   - `sensor.solcast_pv_forecast_forecast_tomorrow`

3. **–ë–∞—Ç–∞—Ä–µ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**:

   - `sensor.inverter_battery` - —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ (%)
   - `sensor.inverter_battery_power` - –º–æ—â–Ω–æ—Å—Ç—å –∑–∞—Ä—è–¥–∞/—Ä–∞–∑—Ä—è–¥–∞

4. **–≠–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º–∞**:

   - `sensor.inverter_load_power` - –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–æ–º–∞
   - `sensor.inverter_grid_power` - –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –≤ —Å–µ—Ç—å

5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–º** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ):

   - `select.inverter_work_mode` - —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
   - `switch.inverter_battery_grid_charging` - –∑–∞—Ä—è–¥ —Å —Å–µ—Ç–∏
   - `select.inverter_time_of_use` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Time of Use (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - `switch.inverter_export_surplus` - —ç–∫—Å–ø–æ—Ä—Ç –∏–∑–ª–∏—à–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

6. **MQTT —Ç–∞—Ä–∏—Ñ—ã** (ha_Pstryk):
   - –¢–æ–ø–∏–∫ `energy/forecast/buy` - —Ç–∞—Ä–∏—Ñ—ã –ø–æ–∫—É–ø–∫–∏
   - –¢–æ–ø–∏–∫ `energy/forecast/sell` - —Ç–∞—Ä–∏—Ñ—ã –ø—Ä–æ–¥–∞–∂–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Devices & Services**
2. –ù–∞–∂–º–∏—Ç–µ **Add Integration**
3. –ù–∞–π–¥–∏—Ç–µ **Energy Arbitrage**
4. –°–ª–µ–¥—É–π—Ç–µ –º–∞—Å—Ç–µ—Ä—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

#### –®–∞–≥ 1: –°–µ–Ω—Å–æ—Ä—ã —Å–æ–ª–Ω–µ—á–Ω–æ–π –∏ —ç–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º—ã

- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–∏ entity_id –¥–ª—è –≤—Å–µ—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–¥ –≤–∞—à–∏ entity_id

#### –®–∞–≥ 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–º

- –í—ã–±–µ—Ä–∏—Ç–µ select –∏ switch –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–º
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ entity_id –¥–ª—è Time of Use –∏ Export Surplus (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ entity_id

#### –®–∞–≥ 3: MQTT —Ç–∞—Ä–∏—Ñ—ã

- –£–∫–∞–∂–∏—Ç–µ MQTT —Ç–æ–ø–∏–∫–∏ –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)

#### –®–∞–≥ 4: –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–∞–Ω–µ–ª–µ–π: **10.6 –∫–í—Ç**
- –ï–º–∫–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏: **15 –∫–í—Ç‚ãÖ—á**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏: **5 –∫–í—Ç**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤: **20%**
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞: 40%** (–Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏: **90%**
- –ò –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

## –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ entity

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä—ã

- `sensor.energy_arbitrage_next_action` - –°–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `sensor.energy_arbitrage_target_power` - –¶–µ–ª–µ–≤–∞—è –º–æ—â–Ω–æ—Å—Ç—å –∑–∞—Ä—è–¥–∞/—Ä–∞–∑—Ä—è–¥–∞
- `sensor.energy_arbitrage_profit_forecast` - –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±—ã–ª–∏ (EUR)
- `sensor.energy_arbitrage_battery_target` - –¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏
- `sensor.energy_arbitrage_roi` - –û–∂–∏–¥–∞–µ–º–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (%)
- `sensor.energy_arbitrage_status` - –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### üß† –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä—ã

- `sensor.energy_arbitrage_energy_forecast` - –ü—Ä–æ–≥–Ω–æ–∑ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- `sensor.energy_arbitrage_price_windows` - –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–æ–≤—ã—Ö –æ–∫–æ–Ω
- `sensor.energy_arbitrage_strategic_plan` - –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –æ–ø–µ—Ä–∞—Ü–∏–π

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

- `sensor.energy_arbitrage_next_buy_window` - –°–ª–µ–¥—É—é—â–µ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- `sensor.energy_arbitrage_next_sell_window` - –°–ª–µ–¥—É—é—â–µ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏
- `sensor.energy_arbitrage_today_profit` - –ü—Ä–∏–±—ã–ª—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- `sensor.energy_arbitrage_monthly_profit` - –ü—Ä–∏–±—ã–ª—å –∑–∞ –º–µ—Å—è—Ü
- `sensor.energy_arbitrage_current_buy_price` - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏
- `sensor.energy_arbitrage_current_sell_price` - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
- –ò –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...

### –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏

- `switch.energy_arbitrage_enabled` - –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- `switch.energy_arbitrage_emergency_mode` - –ê–≤–∞—Ä–∏–π–Ω—ã–π —Ä–µ–∂–∏–º
- `switch.energy_arbitrage_force_charge` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –±–∞—Ç–∞—Ä–µ–∏

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- `select.energy_arbitrage_strategy` - –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- `number.energy_arbitrage_min_arbitrage_depth` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ (20-80%)
- –î—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ UI

## –°–µ—Ä–≤–∏—Å—ã

### `energy_arbitrage.recalculate`

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

### `energy_arbitrage.set_battery_reserve`

```yaml
service: energy_arbitrage.set_battery_reserve
data:
  reserve_percent: 25
```

### `energy_arbitrage.manual_override`

```yaml
service: energy_arbitrage.manual_override
data:
  hours: 2
```

### `energy_arbitrage.clear_manual_override`

–û—Ç–º–µ–Ω–∞ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### `energy_arbitrage.force_work_mode`

```yaml
service: energy_arbitrage.force_work_mode
data:
  work_mode: 'Export First'
  duration_minutes: 30
```

### `energy_arbitrage.force_grid_charging`

```yaml
service: energy_arbitrage.force_grid_charging
data:
  enable: true
  duration_minutes: 60
```

## üß† –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**:

```
üîÆ EnergyBalancePredictor ‚Üí ‚è∞ TimeWindowAnalyzer ‚Üí üéØ StrategicPlanner ‚Üí üé≤ Optimizer
```

#### 1Ô∏è‚É£ **EnergyBalancePredictor** - –ü—Ä–æ–≥–Ω–æ–∑ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã PV –æ—Ç Solcast –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–≤—Ç—Ä–∞
- –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–æ–º–∞
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–ª–∏—à–∫–∏/–¥–µ—Ñ–∏—Ü–∏—Ç—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: `charge_aggressive`, `charge_moderate`, `sell_aggressive`, `sell_partial`, `hold`

#### 2Ô∏è‚É£ **TimeWindowAnalyzer** - –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω

- –ù–∞—Ö–æ–¥–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ü–µ–Ω–æ–≤—ã–µ –æ–∫–Ω–∞ –∏–∑ MQTT –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ (`high`, `medium`, `low`)
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –º–æ—â–Ω–æ—Å—Ç–∏ –±–∞—Ç–∞—Ä–µ–∏

#### 3Ô∏è‚É£ **StrategicPlanner** - –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- –°–æ–∑–¥–∞–µ—Ç 24-48 —á–∞—Å–æ–≤—ã–µ –ø–ª–∞–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏: `energy_critical_deficit`, `surplus_both_days`, `transition_periods`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ù–æ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

#### üéØ **–ü–†–ò–û–†–ò–¢–ï–¢ 1: –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è** (confidence ‚â• 0.8)

```
üéØ STRATEGIC: Critical charging: 3000Wh needed for energy deficit
```

#### ‚è∞ **–ü–†–ò–û–†–ò–¢–ï–¢ 2: –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ** (time_pressure = high)

```
‚è∞ TIME CRITICAL: Buy window ending in 0.5h (Price: 0.145)
```

#### ‚ö° **–ü–†–ò–û–†–ò–¢–ï–¢ 3: –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ**

```
‚ö° PLANNED: Today needs battery (Time: 2.1h, ROI: 16.3%)
```

#### üìä **–ü–†–ò–û–†–ò–¢–ï–¢ 4: –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ**

```
üìä STANDARD: Energy balance today (ROI: 12.8%)
```

#### üí∞ **–ü–†–ò–û–†–ò–¢–ï–¢ 5: –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂** (fallback)

```
üí∞ TRADITIONAL: Good buy opportunity (ROI: 18.2%)
```

#### üîÑ **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –£–º–Ω–æ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ**

```
üéØ STRATEGIC HOLD: Planning for tomorrow deficit. Next: buy in 2.3h
```

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–õ–∏–º–∏—Ç –¥–Ω–µ–≤–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –±–∞—Ç–∞—Ä–µ–∏**

   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `today_cycles ‚â• max_daily_cycles` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2.0)
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí `HOLD` (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π)

2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `battery_level ‚â• min_arbitrage_depth` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è 20-80%, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 40%)
   - –ï—Å–ª–∏ –Ω–∏–∂–µ ‚Üí `HOLD` (–∑–∞—â–∏—Ç–∞ –±–∞—Ç–∞—Ä–µ–∏)

### –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

#### üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –¥–µ—Ñ–∏—Ü–∏—Ç**

- –°—Ä–æ—á–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –≤ –ª—É—á—à–∏—Ö —Ü–µ–Ω–æ–≤—ã—Ö –æ–∫–Ω–∞—Ö
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–¥ –ø—Ä–∏–±—ã–ª—å—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ 3-—Ö —Ü–µ–Ω–æ–≤—ã—Ö –æ–∫–æ–Ω

#### üü¢ **–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∏–∑–ª–∏—à–µ–∫ –æ–±–æ–∏—Ö –¥–Ω–µ–π**

- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ –∏–∑–ª–∏—à–∫–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ 50%+ —É—Ä–æ–≤–Ω—è –±–∞—Ç–∞—Ä–µ–∏
- –ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–ø-2 —Ü–µ–Ω–æ–≤—ã—Ö –æ–∫–Ω–∞

#### üîÑ **–ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**

- `surplus_today ‚Üí deficit_tomorrow`: –ü—Ä–æ–¥–∞–∂–∞ —É—Ç—Ä–æ–º + –∑–∞—Ä—è–¥–∫–∞ –≤–µ—á–µ—Ä–æ–º
- `deficit_today ‚Üí surplus_tomorrow`: –ó–∞—Ä—è–¥–∫–∞ —Å–µ–≥–æ–¥–Ω—è + –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∂–µ

#### üí° **–û–ø–ø–æ—Ä—Ç—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ
- –£–º–µ—Ä–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ 2 –∫–í—Ç‚ãÖ—á
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–∏–±—ã–ª—å—é –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é

**üîÑ –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω–≤–µ—Ä—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

- **–ó–∞—Ä—è–¥–∫–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞:** –ò–Ω–≤–µ—Ä—Ç–µ—Ä —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞—Ä—è–¥–∫–æ–π –±–∞—Ç–∞—Ä–µ–∏ –æ—Ç PV
- **–≠–∫—Å–ø–æ—Ä—Ç –∏–∑–ª–∏—à–∫–æ–≤:** –ò–Ω–≤–µ—Ä—Ç–µ—Ä —Å–∞–º —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–ª–∏—à–∫–∏ –≤ —Å–µ—Ç—å
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏:** –ò–Ω–≤–µ—Ä—Ç–µ—Ä —Å–∞–º —Ä–∞–∑—Ä—è–∂–∞–µ—Ç –±–∞—Ç–∞—Ä–µ—é –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è

_–°–∏—Å—Ç–µ–º–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö_

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä                  | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                               |
| ------------------------- | -------- | ---------------------------------------- |
| **Min Arbitrage Margin**  | 15%      | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞        |
| **Max Daily Cycles**      | 2.0      | –ó–∞—â–∏—Ç–∞ –±–∞—Ç–∞—Ä–µ–∏ –æ—Ç –∏–∑–Ω–æ—Å–∞                 |
| **Min Arbitrage Depth**   | 40%      | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞        |
| **Max Battery Power**     | 5000W    | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏            |
| **Strategic Plan Update** | 30 –º–∏–Ω   | –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞–Ω–æ–≤ |
| **Time Window Analysis**  | 24—á      | –ì–æ—Ä–∏–∑–æ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ü–µ–Ω–æ–≤—ã—Ö –æ–∫–æ–Ω            |
| **Planning Horizon**      | 48—á      | –ì–æ—Ä–∏–∑–æ–Ω—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è    |

### üîç –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

1. **–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥–Ω–æ–∑** (EnergyBalancePredictor):

   - –ü–æ–ª—É—á–µ–Ω–∏–µ PV –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –æ—Ç Solcast
   - –†–∞—Å—á–µ—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ 24-48—á
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: charge/sell/hold

2. **–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω** (TimeWindowAnalyzer):

   - –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –Ω–∏–∑–∫–∏—Ö/–≤—ã—Å–æ–∫–∏—Ö —Ü–µ–Ω
   - –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫–Ω–∞
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è

3. **–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** (StrategicPlanner):

   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ 24-48—á
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±–∞—Ç–∞—Ä–µ–∏
   - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

4. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π** (ArbitrageOptimizer):
   - –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–æ–≤

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –∏–Ω–≤–µ—Ä—Ç–æ—Ä–∞

#### –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ (`charge_arbitrage`)

- `Grid Charging`: `True` (–∑–∞—Ä—è–¥–∫–∞ —Å —Å–µ—Ç–∏)
- `Export Surplus`: `False` (–Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å)
- `Time of Use`: `Disabled` (–æ—Ç–∫–ª—é—á–∏—Ç—å ToU)
- `Work Mode`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º

#### –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ (`sell_arbitrage`)

- `Work Mode`: `Export First` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞)
- `Grid Charging`: `False` (–Ω–µ –∑–∞—Ä—è–∂–∞—Ç—å —Å —Å–µ—Ç–∏)
- `Export Surplus`: `True` (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–ª–∏—à–∫–∏)
- `Time of Use`: `Enabled` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ToU)

#### –†–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è (`hold`)

- `Time of Use`: `Enabled` (–≤–∫–ª—é—á–∏—Ç—å ToU)
- `Work Mode`: `Zero Export To Load` (—Å–∞–º–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ)
- `Export Surplus`: `True` (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–ª–∏—à–∫–∏)
- `Grid Charging`: `False` (–Ω–µ –∑–∞—Ä—è–∂–∞—Ç—å —Å —Å–µ—Ç–∏)

### –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ –±–∞—Ç–∞—Ä–µ–∏**: 20% (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **Cooldown –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏**: 5 –º–∏–Ω—É—Ç
- **–ê–≤–∞—Ä–∏–π–Ω—ã–π —Ä–µ–∂–∏–º**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏
- **–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Home Assistant

### –ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞

```yaml
type: entities
title: Energy Arbitrage - –û—Å–Ω–æ–≤–Ω–æ–µ
entities:
  - sensor.energy_arbitrage_status
  - sensor.energy_arbitrage_next_action
  - sensor.energy_arbitrage_target_power
  - sensor.energy_arbitrage_profit_forecast
  - sensor.energy_arbitrage_roi
  - switch.energy_arbitrage_enabled
  - switch.energy_arbitrage_emergency_mode
  - select.energy_arbitrage_strategy

---
type: entities
title: Energy Arbitrage - –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
entities:
  - sensor.energy_arbitrage_energy_forecast
  - sensor.energy_arbitrage_price_windows
  - sensor.energy_arbitrage_strategic_plan
  - number.energy_arbitrage_min_arbitrage_depth
  - switch.energy_arbitrage_force_charge
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

#### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

```yaml
automation:
  - alias: 'Strategic Plan Notification'
    trigger:
      - platform: state
        entity_id: sensor.energy_arbitrage_strategic_plan
        to: 'executing'
    action:
      - service: notify.telegram
        data:
          message: >
            üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!
            –°—Ü–µ–Ω–∞—Ä–∏–π: {{ state_attr('sensor.energy_arbitrage_strategic_plan', 'scenario') }}
            –ü—Ä–∏–±—ã–ª—å: {{ state_attr('sensor.energy_arbitrage_strategic_plan', 'expected_profit') }}

  - alias: 'Time Critical Opportunity'
    trigger:
      - platform: state
        entity_id: sensor.energy_arbitrage_price_windows
        attribute: time_pressure
        to: 'high'
    action:
      - service: notify.telegram
        data:
          message: >
            ‚è∞ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–≤–æ–µ –æ–∫–Ω–æ!
            –î–µ–π—Å—Ç–≤–∏–µ: {{ state_attr('sensor.energy_arbitrage_price_windows', 'current_action') }}
            –í—Ä–µ–º—è: {{ state_attr('sensor.energy_arbitrage_price_windows', 'time_remaining') }}
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å MQTT

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MQTT –±—Ä–æ–∫–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–ø–∏–∫–∏ `energy/forecast/buy` –∏ `energy/forecast/sell`
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –º–∞—Å—Å–∏–≤–∞

### –ü—Ä–æ–±–ª–µ–º—ã —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–º

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å entity_id –∏–Ω–≤–µ—Ä—Ç–æ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ select.inverter_work_mode –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ —Ä–µ–∂–∏–º—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ switch.inverter_battery_grid_charging

### –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –º–∞—Ä–∂–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15%)
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ —á–µ—Ä–µ–∑ MQTT
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ Solcast –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ PV
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –±–∞—Ç–∞—Ä–µ–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π

- **Energy Forecast –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "error"**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Solcast —Å–µ–Ω—Å–æ—Ä–æ–≤
- **Price Windows –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "no_windows"**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MQTT –¥–∞–Ω–Ω—ã–µ –∏ –∏—Ö —Ñ–æ—Ä–º–∞—Ç
- **Strategic Plan –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "no_active_plan"**: –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–Ω –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- **–ù–∏–∑–∫–∞—è confidence –≤ –ø–ª–∞–Ω–∞—Ö**: –£–ª—É—á—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (PV –ø—Ä–æ–≥–Ω–æ–∑—ã, —Ü–µ–Ω—ã)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues**: [GitHub Issues](https://github.com/rviar/ha-energy-arbitrage/issues)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [Wiki](https://github.com/rviar/ha-energy-arbitrage/wiki)
- **Community**: [Home Assistant Community Forum](https://community.home-assistant.io/)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª.

## Changelog

### v2.0.0 - –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ üß†

- ‚ú® **–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: EnergyBalancePredictor + TimeWindowAnalyzer + StrategicPlanner
- üéØ **–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ 24-48 —á–∞—Å–æ–≤
- ‚è∞ **–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω**: –¢–æ—á–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∞–≤–ª–µ–Ω–∏–µ–º
- üìä **–ù–æ–≤—ã–µ —Å–µ–Ω—Å–æ—Ä—ã**: Energy Forecast, Price Windows, Strategic Plan
- üéõÔ∏è **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –≥–ª—É–±–∏–Ω–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞**: Min Arbitrage Depth (20-80%)
- ‚öôÔ∏è **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ entity ID**: Time of Use –∏ Export Surplus
- üîÑ **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞**: –£–±—Ä–∞–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–ª–Ω–µ—á–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–æ –∏–Ω–≤–µ—Ä—Ç–µ—Ä—É)
- üé≤ **–ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–µ—à–µ–Ω–∏–π**: 5-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
- üõ°Ô∏è **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –ø–ª–∞–Ω—ã**: –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### v1.0.0

- –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑
- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤
- UI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Å–µ–Ω—Å–æ—Ä–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
